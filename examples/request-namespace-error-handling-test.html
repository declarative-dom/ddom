<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Namespace Error Handling Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .result { padding: 10px; margin: 10px 0; border-radius: 3px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .loading { background-color: #fff3cd; color: #856404; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 3px; overflow: auto; }
    </style>
</head>
<body>
    <h1>Request Namespace Error Handling Test</h1>
    <p>Testing error handling scenarios with Request namespace</p>

    <div class="test-section">
        <h3>Test 1: 404 Not Found Error</h3>
        <div id="test1-container"></div>
        <div id="test1-result" class="result loading">Loading...</div>
    </div>

    <div class="test-section">
        <h3>Test 2: Network Error (Invalid URL)</h3>
        <div id="test2-container"></div>
        <div id="test2-result" class="result loading">Loading...</div>
    </div>

    <div class="test-section">
        <h3>Test 3: CORS Error (Invalid Origin)</h3>
        <div id="test3-container"></div>
        <div id="test3-result" class="result loading">Loading...</div>
    </div>

    <div class="test-section">
        <h3>Test 4: Valid Request (Control)</h3>
        <div id="test4-container"></div>
        <div id="test4-result" class="result loading">Loading...</div>
    </div>

    <script type="module">
        import DDOM from '../lib/dist/index.js';

        function runTests() {
            // Test 1: 404 Not Found Error
            const test1Component = {
                tagName: 'div',
                id: 'test1-data',
                $notFoundTest: {
                    Request: {
                        url: "https://jsonplaceholder.typicode.com/posts/99999",
                        method: "GET"
                    }
                },
                textContent: 'Testing 404 error...'
            };

            const test1Element = DDOM.createElement(test1Component);
            document.getElementById('test1-container').appendChild(test1Element);

            DDOM.createEffect(() => {
                const data = test1Element.$notFoundTest.get();
                const resultDiv = document.getElementById('test1-result');
                
                if (data) {
                    if (data.error) {
                        resultDiv.className = 'result success'; // Success because we expected an error
                        resultDiv.innerHTML = `
                            <strong>Expected Error Caught!</strong><br>
                            <strong>Error:</strong> ${data.error}<br>
                            <strong>Type:</strong> ${data.type}<br>
                            <strong>Timestamp:</strong> ${data.timestamp}<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        `;
                        test1Element.textContent = `Error handled: ${data.error}`;
                    } else {
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `<strong>Unexpected Success:</strong> Expected 404 error but got data: <pre>${JSON.stringify(data, null, 2)}</pre>`;
                    }
                }
            });

            // Test 2: Network Error (Invalid URL)
            const test2Component = {
                tagName: 'div',
                id: 'test2-data',
                $networkErrorTest: {
                    Request: {
                        url: "https://invalid-domain-that-does-not-exist-12345.com/api/test",
                        method: "GET"
                    }
                },
                textContent: 'Testing network error...'
            };

            const test2Element = DDOM.createElement(test2Component);
            document.getElementById('test2-container').appendChild(test2Element);

            DDOM.createEffect(() => {
                const data = test2Element.$networkErrorTest.get();
                const resultDiv = document.getElementById('test2-result');
                
                if (data) {
                    if (data.error) {
                        resultDiv.className = 'result success'; // Success because we expected an error
                        resultDiv.innerHTML = `
                            <strong>Expected Network Error Caught!</strong><br>
                            <strong>Error:</strong> ${data.error}<br>
                            <strong>Type:</strong> ${data.type}<br>
                            <strong>Timestamp:</strong> ${data.timestamp}<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        `;
                        test2Element.textContent = `Network error handled: ${data.error}`;
                    } else {
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `<strong>Unexpected Success:</strong> Expected network error but got data: <pre>${JSON.stringify(data, null, 2)}</pre>`;
                    }
                }
            });

            // Test 3: CORS Error (trying to access a different domain that might block CORS)
            const test3Component = {
                tagName: 'div',
                id: 'test3-data',
                $corsErrorTest: {
                    Request: {
                        url: "https://httpbin.org/status/500", // This should return a 500 error
                        method: "GET"
                    }
                },
                textContent: 'Testing HTTP error status...'
            };

            const test3Element = DDOM.createElement(test3Component);
            document.getElementById('test3-container').appendChild(test3Element);

            DDOM.createEffect(() => {
                const data = test3Element.$corsErrorTest.get();
                const resultDiv = document.getElementById('test3-result');
                
                if (data) {
                    if (data.error) {
                        resultDiv.className = 'result success'; // Success because we expected an error
                        resultDiv.innerHTML = `
                            <strong>Expected HTTP Error Caught!</strong><br>
                            <strong>Error:</strong> ${data.error}<br>
                            <strong>Type:</strong> ${data.type}<br>
                            <strong>Timestamp:</strong> ${data.timestamp}<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        `;
                        test3Element.textContent = `HTTP error handled: ${data.error}`;
                    } else {
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `<strong>Unexpected Success:</strong> Expected HTTP error but got data: <pre>${JSON.stringify(data, null, 2)}</pre>`;
                    }
                }
            });

            // Test 4: Valid Request (Control Test)
            const test4Component = {
                tagName: 'div',
                id: 'test4-data',
                $validTest: {
                    Request: {
                        url: "https://jsonplaceholder.typicode.com/posts/1",
                        method: "GET"
                    }
                },
                textContent: 'Testing valid request...'
            };

            const test4Element = DDOM.createElement(test4Component);
            document.getElementById('test4-container').appendChild(test4Element);

            DDOM.createEffect(() => {
                const data = test4Element.$validTest.get();
                const resultDiv = document.getElementById('test4-result');
                
                if (data) {
                    if (data.error) {
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `<strong>Unexpected Error:</strong> ${data.error}`;
                    } else {
                        resultDiv.className = 'result success';
                        resultDiv.innerHTML = `
                            <strong>Success!</strong> Valid request worked correctly<br>
                            <strong>Post Title:</strong> ${data.title}<br>
                            <strong>User ID:</strong> ${data.userId}<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        `;
                        test4Element.textContent = `Valid request: ${data.title}`;
                    }
                }
            });
        }

        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runTests);
        } else {
            runTests();
        }
    </script>
</body>
</html>