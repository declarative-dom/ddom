<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Namespace Basic Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .result { padding: 10px; margin: 10px 0; border-radius: 3px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .loading { background-color: #fff3cd; color: #856404; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 3px; overflow: auto; }
    </style>
</head>
<body>
    <h1>Request Namespace Basic Test</h1>
    <p>Testing basic Request namespace functionality with JSONPlaceholder API</p>

    <div class="test-section">
        <h3>Test 1: Basic GET Request</h3>
        <div id="test1-container"></div>
        <div id="test1-result" class="result loading">Loading...</div>
    </div>

    <div class="test-section">
        <h3>Test 2: POST Request with JSON Body</h3>
        <div id="test2-container"></div>
        <div id="test2-result" class="result loading">Loading...</div>
    </div>

    <div class="test-section">
        <h3>Test 3: Request with Headers</h3>
        <div id="test3-container"></div>
        <div id="test3-result" class="result loading">Loading...</div>
    </div>

    <script type="module">
        import DDOM from '../lib/dist/index.js';

        function runTests() {
            // Test 1: Basic GET Request
            const test1Component = {
                tagName: 'div',
                id: 'test1-data',
                $userData: {
                    Request: {
                        url: "https://jsonplaceholder.typicode.com/users/1"
                    }
                },
                textContent: 'Loading user data...'
            };

            const test1Element = DDOM.createElement(test1Component);
            document.getElementById('test1-container').appendChild(test1Element);

            // Set up reactive effect to update UI when data loads
            DDOM.createEffect(() => {
                const data = test1Element.$userData.get();
                const resultDiv = document.getElementById('test1-result');
                
                if (data) {
                    if (data.error) {
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `<strong>Error:</strong> ${data.error}`;
                    } else {
                        resultDiv.className = 'result success';
                        resultDiv.innerHTML = `
                            <strong>Success!</strong> Loaded user: ${data.name}<br>
                            <strong>Email:</strong> ${data.email}<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        `;
                        test1Element.textContent = `User: ${data.name}`;
                    }
                }
            });

            // Test 2: POST Request with JSON Body
            const test2Component = {
                tagName: 'div',
                id: 'test2-data',
                $postResult: {
                    Request: {
                        url: "https://jsonplaceholder.typicode.com/posts",
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: {
                            title: "Test Post from DDOM",
                            body: "This is a test post created via DDOM Request namespace",
                            userId: 1
                        }
                    }
                },
                textContent: 'Creating post...'
            };

            const test2Element = DDOM.createElement(test2Component);
            document.getElementById('test2-container').appendChild(test2Element);

            DDOM.createEffect(() => {
                const data = test2Element.$postResult.get();
                const resultDiv = document.getElementById('test2-result');
                
                if (data) {
                    if (data.error) {
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `<strong>Error:</strong> ${data.error}`;
                    } else {
                        resultDiv.className = 'result success';
                        resultDiv.innerHTML = `
                            <strong>Success!</strong> Created post with ID: ${data.id}<br>
                            <strong>Title:</strong> ${data.title}<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        `;
                        test2Element.textContent = `Created post: ${data.title}`;
                    }
                }
            });

            // Test 3: Request with Headers
            const test3Component = {
                tagName: 'div',
                id: 'test3-data',
                $headerTest: {
                    Request: {
                        url: "https://jsonplaceholder.typicode.com/posts/1",
                        method: "GET",
                        headers: {
                            "Accept": "application/json",
                            "User-Agent": "DDOM-Request-Test/1.0"
                        }
                    }
                },
                textContent: 'Loading with custom headers...'
            };

            const test3Element = DDOM.createElement(test3Component);
            document.getElementById('test3-container').appendChild(test3Element);

            DDOM.createEffect(() => {
                const data = test3Element.$headerTest.get();
                const resultDiv = document.getElementById('test3-result');
                
                if (data) {
                    if (data.error) {
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `<strong>Error:</strong> ${data.error}`;
                    } else {
                        resultDiv.className = 'result success';
                        resultDiv.innerHTML = `
                            <strong>Success!</strong> Loaded post: ${data.title}<br>
                            <strong>User ID:</strong> ${data.userId}<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        `;
                        test3Element.textContent = `Post: ${data.title}`;
                    }
                }
            });
        }

        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runTests);
        } else {
            runTests();
        }
    </script>
</body>
</html>