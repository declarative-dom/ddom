<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Namespace Body Types Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .result { padding: 10px; margin: 10px 0; border-radius: 3px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .loading { background-color: #fff3cd; color: #856404; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 3px; overflow: auto; }
    </style>
</head>
<body>
    <h1>Request Namespace Body Types Test</h1>
    <p>Testing various body types with Request namespace</p>

    <div class="test-section">
        <h3>Test 1: JSON Object Body</h3>
        <div id="test1-container"></div>
        <div id="test1-result" class="result loading">Loading...</div>
    </div>

    <div class="test-section">
        <h3>Test 2: Array Body</h3>
        <div id="test2-container"></div>
        <div id="test2-result" class="result loading">Loading...</div>
    </div>

    <div class="test-section">
        <h3>Test 3: FormData Body</h3>
        <div id="test3-container"></div>
        <div id="test3-result" class="result loading">Loading...</div>
    </div>

    <div class="test-section">
        <h3>Test 4: URLSearchParams Body</h3>
        <div id="test4-container"></div>
        <div id="test4-result" class="result loading">Loading...</div>
    </div>

    <script type="module">
        import DDOM from '../lib/dist/index.js';

        function runTests() {
            // Test 1: JSON Object Body
            const test1Component = {
                tagName: 'div',
                id: 'test1-data',
                $jsonPost: {
                    Request: {
                        url: "https://jsonplaceholder.typicode.com/posts",
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: {
                            title: "JSON Object Test",
                            body: "Testing JSON object body conversion",
                            userId: 42,
                            metadata: {
                                test: true,
                                timestamp: new Date().toISOString()
                            }
                        }
                    }
                },
                textContent: 'Posting JSON object...'
            };

            const test1Element = DDOM.createElement(test1Component);
            document.getElementById('test1-container').appendChild(test1Element);

            DDOM.createEffect(() => {
                const data = test1Element.$jsonPost.get();
                const resultDiv = document.getElementById('test1-result');
                
                if (data) {
                    if (data.error) {
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `<strong>Error:</strong> ${data.error}`;
                    } else {
                        resultDiv.className = 'result success';
                        resultDiv.innerHTML = `
                            <strong>Success!</strong> JSON object posted, received ID: ${data.id}<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        `;
                    }
                }
            });

            // Test 2: Array Body 
            const test2Component = {
                tagName: 'div',
                id: 'test2-data',
                $arrayPost: {
                    Request: {
                        url: "https://jsonplaceholder.typicode.com/posts",
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: [
                            { action: "create", type: "user" },
                            { action: "update", type: "post" },
                            { action: "delete", type: "comment" }
                        ]
                    }
                },
                textContent: 'Posting array...'
            };

            const test2Element = DDOM.createElement(test2Component);
            document.getElementById('test2-container').appendChild(test2Element);

            DDOM.createEffect(() => {
                const data = test2Element.$arrayPost.get();
                const resultDiv = document.getElementById('test2-result');
                
                if (data) {
                    if (data.error) {
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `<strong>Error:</strong> ${data.error}`;
                    } else {
                        resultDiv.className = 'result success';
                        resultDiv.innerHTML = `
                            <strong>Success!</strong> Array posted, received ID: ${data.id}<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        `;
                    }
                }
            });

            // Test 3: FormData Body (simulated)
            const test3Component = {
                tagName: 'div',
                id: 'test3-data',
                $formPost: {
                    Request: {
                        url: "https://jsonplaceholder.typicode.com/posts",
                        method: "POST",
                        body: {
                            FormData: {
                                title: "FormData Test",
                                body: "Testing FormData body conversion",
                                userId: "99",
                                category: "test"
                            }
                        }
                    }
                },
                textContent: 'Posting FormData...'
            };

            const test3Element = DDOM.createElement(test3Component);
            document.getElementById('test3-container').appendChild(test3Element);

            DDOM.createEffect(() => {
                const data = test3Element.$formPost.get();
                const resultDiv = document.getElementById('test3-result');
                
                if (data) {
                    if (data.error) {
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `<strong>Error:</strong> ${data.error}`;
                    } else {
                        resultDiv.className = 'result success';
                        resultDiv.innerHTML = `
                            <strong>Success!</strong> FormData posted, received ID: ${data.id}<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        `;
                    }
                }
            });

            // Test 4: URLSearchParams Body
            const test4Component = {
                tagName: 'div',
                id: 'test4-data',
                $paramsPost: {
                    Request: {
                        url: "https://jsonplaceholder.typicode.com/posts",
                        method: "POST",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded"
                        },
                        body: {
                            URLSearchParams: {
                                title: "URLSearchParams Test",
                                body: "Testing URLSearchParams body conversion",
                                userId: "88"
                            }
                        }
                    }
                },
                textContent: 'Posting URLSearchParams...'
            };

            const test4Element = DDOM.createElement(test4Component);
            document.getElementById('test4-container').appendChild(test4Element);

            DDOM.createEffect(() => {
                const data = test4Element.$paramsPost.get();
                const resultDiv = document.getElementById('test4-result');
                
                if (data) {
                    if (data.error) {
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `<strong>Error:</strong> ${data.error}`;
                    } else {
                        resultDiv.className = 'result success';
                        resultDiv.innerHTML = `
                            <strong>Success!</strong> URLSearchParams posted, received ID: ${data.id}<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        `;
                    }
                }
            });
        }

        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runTests);
        } else {
            runTests();
        }
    </script>
</body>
</html>