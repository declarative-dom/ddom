<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDOM New Request Syntax Demo</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .example { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .example h2 { margin-top: 0; color: #333; }
        .code { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 5px; font-family: monospace; overflow-x: auto; }
        .result { background: white; border: 1px solid #ddd; padding: 15px; border-radius: 5px; margin-top: 10px; }
        .loading { color: #007bff; }
        .error { color: #dc3545; }
        .success { color: #28a745; }
    </style>
</head>
<body>
    <h1>DDOM New Request Syntax Demo</h1>
    <p>This page demonstrates the new serializable Request object syntax.</p>

    <div class="example">
        <h2>Example 1: Basic GET Request</h2>
        <div class="code">
{
  tagName: 'user-profile',
  $userData: {
    Request: {
      url: "https://jsonplaceholder.typicode.com/users/1"
    }
  }
}
        </div>
        <div class="result" id="example1-result">Loading...</div>
    </div>

    <div class="example">
        <h2>Example 2: POST Request with JSON Body</h2>
        <div class="code">
{
  tagName: 'create-user-form',
  $createUser: {
    Request: {
      url: "https://jsonplaceholder.typicode.com/posts",
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: {
        title: "DDOM Request Test",
        body: "Testing new serializable Request syntax",
        userId: 1
      }
    }
  }
}
        </div>
        <div class="result" id="example2-result">Loading...</div>
    </div>

    <div class="example">
        <h2>Example 3: FormData Request</h2>
        <div class="code">
{
  tagName: 'upload-form',
  $uploadFile: {
    Request: {
      url: "https://httpbin.org/post",
      method: "POST",
      body: {
        FormData: {
          field1: "value1",
          field2: "value2"
        }
      }
    }
  }
}
        </div>
        <div class="result" id="example3-result">Loading...</div>
    </div>

    <div class="example">
        <h2>Example 4: Comprehensive Request Options</h2>
        <div class="code">
{
  tagName: 'comprehensive-request',
  $comprehensiveRequest: {
    Request: {
      url: "https://jsonplaceholder.typicode.com/users/2",
      method: "GET",
      headers: {
        "Accept": "application/json",
        "X-Custom-Header": "test-value"
      },
      mode: "cors",
      credentials: "omit",
      cache: "no-cache"
    }
  }
}
        </div>
        <div class="result" id="example4-result">Loading...</div>
    </div>

    <script type="module">
        import DDOM from '../lib/dist/index.js';

        console.log('Testing DDOM New Request Syntax...');

        // Example 1: Basic GET Request
        DDOM.customElements.define({
            tagName: 'user-profile',
            $userData: {
                Request: {
                    url: "https://jsonplaceholder.typicode.com/users/1"
                }
            }
        });

        // Example 2: POST Request with JSON Body
        DDOM.customElements.define({
            tagName: 'create-user-form',
            $createUser: {
                Request: {
                    url: "https://jsonplaceholder.typicode.com/posts",
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: {
                        title: "DDOM Request Test",
                        body: "Testing new serializable Request syntax",
                        userId: 1
                    }
                }
            }
        });

        // Example 3: FormData Request
        DDOM.customElements.define({
            tagName: 'upload-form',
            $uploadFile: {
                Request: {
                    url: "https://httpbin.org/post",
                    method: "POST",
                    body: {
                        FormData: {
                            field1: "value1",
                            field2: "value2"
                        }
                    }
                }
            }
        });

        // Example 4: Comprehensive Request Options
        DDOM.customElements.define({
            tagName: 'comprehensive-request',
            $comprehensiveRequest: {
                Request: {
                    url: "https://jsonplaceholder.typicode.com/users/2",
                    method: "GET",
                    headers: {
                        "Accept": "application/json",
                        "X-Custom-Header": "test-value"
                    },
                    mode: "cors",
                    credentials: "omit",
                    cache: "no-cache"
                }
            }
        });

        // Create elements and test
        const userProfile = document.createElement('user-profile');
        const createUserForm = document.createElement('create-user-form');
        const uploadForm = document.createElement('upload-form');
        const comprehensiveRequest = document.createElement('comprehensive-request');
        
        // Test Example 1
        const example1Result = document.getElementById('example1-result');
        
        if (userProfile.$userData && userProfile.$userData.get) {
            example1Result.innerHTML = '<span class="loading">✓ userData Signal created, fetching...</span>';
            
            DDOM.createEffect(() => {
                const userData = userProfile.$userData.get();
                
                if (userData === null) {
                    return; // Still loading
                } else if (userData.error) {
                    example1Result.innerHTML = `<div class="error">❌ Error: ${userData.error}</div>`;
                } else {
                    example1Result.innerHTML = `
                        <div class="success">✅ User Data Loaded:</div>
                        <pre>${JSON.stringify(userData, null, 2)}</pre>
                    `;
                }
            });
        } else {
            example1Result.innerHTML = '<div class="error">❌ Failed to create userData Signal</div>';
        }

        // Test Example 2
        const example2Result = document.getElementById('example2-result');
        
        if (createUserForm.$createUser && createUserForm.$createUser.get) {
            example2Result.innerHTML = '<span class="loading">✓ createUser Signal created, posting...</span>';
            
            DDOM.createEffect(() => {
                const result = createUserForm.$createUser.get();
                
                if (result === null) {
                    return; // Still loading
                } else if (result.error) {
                    example2Result.innerHTML = `<div class="error">❌ POST Error: ${result.error}</div>`;
                } else {
                    example2Result.innerHTML = `
                        <div class="success">✅ POST Request Successful:</div>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `;
                }
            });
        } else {
            example2Result.innerHTML = '<div class="error">❌ Failed to create createUser Signal</div>';
        }

        // Test Example 3
        const example3Result = document.getElementById('example3-result');
        
        if (uploadForm.$uploadFile && uploadForm.$uploadFile.get) {
            example3Result.innerHTML = '<span class="loading">✓ uploadFile Signal created, uploading...</span>';
            
            DDOM.createEffect(() => {
                const result = uploadForm.$uploadFile.get();
                
                if (result === null) {
                    return; // Still loading
                } else if (result.error) {
                    example3Result.innerHTML = `<div class="error">❌ Upload Error: ${result.error}</div>`;
                } else {
                    example3Result.innerHTML = `
                        <div class="success">✅ FormData Upload Successful:</div>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `;
                }
            });
        } else {
            example3Result.innerHTML = '<div class="error">❌ Failed to create uploadFile Signal</div>';
        }

        // Test Example 4
        const example4Result = document.getElementById('example4-result');
        
        if (comprehensiveRequest.$comprehensiveRequest && comprehensiveRequest.$comprehensiveRequest.get) {
            example4Result.innerHTML = '<span class="loading">✓ comprehensiveRequest Signal created, fetching...</span>';
            
            DDOM.createEffect(() => {
                const result = comprehensiveRequest.$comprehensiveRequest.get();
                
                if (result === null) {
                    return; // Still loading
                } else if (result.error) {
                    example4Result.innerHTML = `<div class="error">❌ Error: ${result.error}</div>`;
                } else {
                    example4Result.innerHTML = `
                        <div class="success">✅ Comprehensive Request Successful:</div>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `;
                }
            });
        } else {
            example4Result.innerHTML = '<div class="error">❌ Failed to create comprehensiveRequest Signal</div>';
        }

        console.log('All examples initialized');
    </script>
</body>
</html>