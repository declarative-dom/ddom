<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Declarative Fetch Test</title>
</head>
<body>
    <div id="app"></div>
    
    <script type="module">
        import DDOM from '../lib/dist/index.js';

        console.log('DDOM loaded:', DDOM);

        // Create app using declarative fetch
        const app = DDOM.customElements.define({
            tagName: 'fetch-demo',
            
            // Direct Request constructor usage
            userData: new Request("https://jsonplaceholder.typicode.com/users/1"),
            
            children: [
                {
                    tagName: 'h1',
                    textContent: 'Declarative Fetch Demo'
                },
                {
                    tagName: 'div',
                    id: 'user-info',
                    children: [
                        {
                            tagName: 'h2',
                            textContent: 'User Data'
                        },
                        {
                            tagName: 'pre',
                            id: 'user-data',
                            textContent: 'Loading user data...'
                        }
                    ]
                }
            ]
        });

        console.log('App defined:', app);

        // Append to DOM
        const fetchDemoElement = document.createElement('fetch-demo');
        document.getElementById('app').appendChild(fetchDemoElement);
        
        console.log('Element created:', fetchDemoElement);
        console.log('userData property:', fetchDemoElement.userData);

        // Set up monitoring to display the fetch results
        setTimeout(() => {
            const fetchDemo = document.querySelector('fetch-demo');
            console.log('Found element:', fetchDemo);
            
            if (fetchDemo && fetchDemo.userData) {
                console.log('userData signal:', fetchDemo.userData);
                
                // Check if it's a signal
                if (fetchDemo.userData.get) {
                    console.log('Setting up effect...');
                    
                    DDOM.createEffect(() => {
                        const data = fetchDemo.userData.get();
                        console.log('Data received:', data);
                        
                        const userDataElement = document.getElementById('user-data');
                        if (userDataElement && data) {
                            userDataElement.textContent = JSON.stringify(data, null, 2);
                        }
                    });
                } else {
                    console.log('userData is not a signal:', typeof fetchDemo.userData);
                }
            } else {
                console.log('No fetchDemo element or userData property');
            }
        }, 1000);
    </script>
</body>
</html>